# AdStackX - æ¨¡çµ„åŒ–å»£å‘Šå¹³å°

AdStackX æ˜¯ä¸€å€‹å°ˆç‚ºå»£å‘Šç®¡ç†æ‰“é€ çš„å¤šç§Ÿæˆ¶å¹³å°ï¼Œä½¿ç”¨ **Laravel**ã€**FastAPI** å’Œ **Vue 3** æ§‹å»ºï¼Œæ”¯æ´å€‹äººåŒ–å»£å‘Šæ¨è–¦ã€å³æ™‚æ•¸æ“šåˆ†æã€RBAC æ¬Šé™æ§åˆ¶å’Œè‡ªå‹•åŒ–éƒ¨ç½²ã€‚æ ¸å¿ƒåŠŸèƒ½åŒ…æ‹¬å»£å‘Šç®¡ç†ï¼ˆå‰µå»ºã€ç·¨è¼¯ã€æŠ•æ”¾ï¼‰ã€æ¨è–¦å¼•æ“ï¼ˆåŸºæ–¼ç”¨æˆ¶è¡Œç‚ºï¼‰ã€å ±è¡¨ç”Ÿæˆï¼ˆå±•ç¤ºã€é»æ“Šã€è½‰æ›ç‡ï¼‰å’Œé«˜æ•ˆç›£æ§ï¼ˆPrometheus + Grafanaï¼‰ã€‚å®ƒé©åˆéœ€è¦å¤šå“ç‰Œé‹ç‡Ÿå’Œé«˜æ“´å±•æ€§çš„å»£å‘Šä¼æ¥­ï¼Œå…·å‚™ SaaS æ½›åŠ›ã€‚

**æ³¨æ„**ï¼šæœ¬å€‰åº«ï¼ˆhttps://github.com/BpsEason/ad-platform.gitï¼‰åƒ…åŒ…å«æ ¸å¿ƒç¨‹å¼ç¢¼ï¼ˆä¾‹å¦‚è‡ªå®šç¾©æ§åˆ¶å™¨ã€æ¨¡å‹ã€å‰ç«¯çµ„ä»¶ï¼‰ã€‚åŸºæœ¬ Laravel æ¡†æ¶ç¨‹å¼ç¢¼ï¼ˆä¾‹å¦‚ `app/Models/User.php`ã€è·¯ç”±æª”æ¡ˆï¼‰å’Œä¾è³´ï¼ˆPHPã€Pythonã€Node.js æ¨¡çµ„ï¼‰éœ€è‡ªè¡Œæ–°å¢ã€‚è«‹æŒ‰ç…§ä¸‹æ–¹ã€Œåˆå§‹åŒ– Laravel å°ˆæ¡ˆã€å’Œã€Œå®‰è£ä¾è³´ã€æ­¥é©Ÿå®Œæˆè¨­ç½®ã€‚

## å¸¸è¦‹å•é¡Œè§£ç­”ï¼ˆFAQï¼‰

ä»¥ä¸‹æ˜¯ä¸€äº›é—œæ–¼ AdStackX çš„å¸¸è¦‹å•é¡Œï¼Œæ¶µè“‹å°ˆæ¡ˆæ¦‚è¿°ã€æŠ€è¡“é¸å‹ã€åŠŸèƒ½å¯¦ç¾ã€éƒ¨ç½²æµç¨‹å’Œé–‹ç™¼æŒ‘æˆ°ï¼Œå¹«åŠ©æ‚¨å¿«é€Ÿäº†è§£ä¸¦ä¸Šæ‰‹ï¼

### 1. ä»€éº¼æ˜¯ AdStackXï¼Ÿå®ƒçš„è¨­è¨ˆç›®æ¨™æ˜¯ä»€éº¼ï¼Ÿ

**ç­”**ï¼šAdStackX æ˜¯ä¸€å€‹ç‚ºå»£å‘Šå¹³å°è¨­è¨ˆçš„å¤šç§Ÿæˆ¶ç³»çµ±ï¼ŒåŸºæ–¼ Laravelï¼ˆå¾Œç«¯ï¼‰ã€FastAPIï¼ˆæ¨è–¦å¼•æ“ï¼‰å’Œ Vue 3ï¼ˆå‰ç«¯ï¼‰ï¼Œæ•´åˆ MySQLã€Redis å’Œ Kafkaï¼Œæä¾›å»£å‘Šç®¡ç†ã€å€‹äººåŒ–æ¨è–¦å’Œå³æ™‚å ±è¡¨åŠŸèƒ½ã€‚

**è¨­è¨ˆç›®æ¨™**ï¼š
- **å¤šå“ç‰Œé‹ç‡Ÿ**ï¼šæ”¯æ´å¤šç§Ÿæˆ¶æ¶æ§‹ï¼Œè®“å¤šå€‹å»£å‘Šå®¢æˆ¶ï¼ˆå¦‚å“ç‰Œ Aã€å“ç‰Œ Bï¼‰å…±ç”¨ç³»çµ±ï¼Œé™ä½é‹ç‡Ÿæˆæœ¬ã€‚
- **å€‹äººåŒ–æ¨è–¦**ï¼šé€é FastAPI å’Œ Kafka å¯¦ç¾åŸºæ–¼ç”¨æˆ¶è¡Œç‚ºçš„å»£å‘Šæ¨è–¦ã€‚
- **é«˜æ•ˆç›£æ§**ï¼šä½¿ç”¨ Prometheus å’Œ Grafana æä¾›å³æ™‚æ€§èƒ½å’Œè³‡æºç›£æ§ã€‚
- **å¿«é€Ÿéƒ¨ç½²**ï¼šæ”¯æ´ Docker å’Œ GitHub Actionsï¼Œç°¡åŒ–æœ¬åœ°é–‹ç™¼å’Œç”Ÿç”¢éƒ¨ç½²ã€‚

**è§£æ±ºçš„ç—›é»**ï¼š
- å‚³çµ±å»£å‘Šç³»çµ±é›£ä»¥æ”¯æ´å¤šå“ç‰Œæ•¸æ“šéš”é›¢ã€‚
- ç¼ºä¹å³æ™‚æ¨è–¦å’Œå ±è¡¨åŠŸèƒ½ã€‚
- å–®é«”æ‡‰ç”¨åœ¨é«˜æµé‡å ´æ™¯ä¸‹çš„æ€§èƒ½ç“¶é ¸ã€‚
- éƒ¨ç½²æµç¨‹è¤‡é›œï¼Œç’°å¢ƒä¸€è‡´æ€§é›£ä¿è­‰ã€‚

### 2. ç‚ºä»€éº¼é¸æ“‡ Laravelã€FastAPI å’Œ Vue 3ï¼Ÿ

**ç­”**ï¼š
- **Laravel**ï¼šæä¾›å¼·å¤§çš„ MVC æ¶æ§‹ã€Eloquent ORM å’Œ Artisan å·¥å…·ï¼Œé©åˆå¿«é€Ÿé–‹ç™¼å»£å‘Šç®¡ç†å’Œ RBAC é‚è¼¯ã€‚æ­é… `spatie/laravel-permission`ï¼Œè¼•é¬†å¯¦ç¾æ¬Šé™æ§åˆ¶ã€‚
- **FastAPI**ï¼šé«˜æ€§èƒ½ï¼ˆåŸºæ–¼ Starlette å’Œ Pydanticï¼‰ï¼Œæ”¯æ´è‡ªå‹•ç”Ÿæˆ Swagger æ–‡æª”ï¼Œé©åˆä½œç‚ºæ¨è–¦å¼•æ“è™•ç†é«˜ä½µç™¼äº‹ä»¶ï¼Œä¸¦æ–¹ä¾¿æ•´åˆ Python ç”Ÿæ…‹çš„ AI/ML æœå‹™ã€‚
- **Vue 3**ï¼šæ”¯æ´éŸ¿æ‡‰å¼å‰ç«¯é–‹ç™¼ï¼Œçµåˆ Vite æä¾›å¿«é€Ÿæ§‹å»ºå’Œå„ªåŒ–çš„ç”¨æˆ¶é«”é©—ï¼Œé©åˆæ‰“é€ ç¾ä»£åŒ–å»£å‘Šç®¡ç†ç•Œé¢ã€‚

### 3. å¤šç§Ÿæˆ¶æ¶æ§‹å¦‚ä½•å¯¦ç¾ï¼Ÿå¦‚ä½•ä¿è­‰æ•¸æ“šéš”é›¢ï¼Ÿ

**ç­”**ï¼šä½¿ç”¨ Laravel çš„è‡ªå®šç¾©ä¸­é–“ä»¶ï¼ˆ`SetTenant`ï¼‰å’Œå…¨å±€ç¯„åœï¼ˆ`TenantScope`ï¼‰å¯¦ç¾å¤šç§Ÿæˆ¶ï¼Œæ¯å€‹ç§Ÿæˆ¶çš„æ•¸æ“šé€é `tenant_id` å­—æ®µéš”é›¢ã€‚MySQL å„²å­˜æ ¸å¿ƒæ•¸æ“šï¼ŒRedis ç”¨æ–¼å¿«å–ï¼ŒKafka è™•ç†äº‹ä»¶æµã€‚Traefik æ ¹æ“šåŸŸåï¼ˆä¾‹å¦‚ `tenant-a.localhost`ï¼‰å‹•æ…‹è·¯ç”±ï¼Œç¢ºä¿è«‹æ±‚æ­£ç¢ºåˆ†ç™¼ã€‚

**å„ªå‹¢**ï¼š
- **æ•¸æ“šå®‰å…¨**ï¼šç§Ÿæˆ¶æ•¸æ“šéš”é›¢ï¼Œé˜²æ­¢äº¤å‰è¨ªå•ã€‚
- **æ€§èƒ½å„ªåŒ–**ï¼šæ¸›å°‘æŸ¥è©¢ä¸­çš„ `WHERE tenant_id = X`ã€‚
- **éˆæ´»æ€§**ï¼šæ”¯æ´å¿«é€Ÿæ–°å¢ç§Ÿæˆ¶ï¼Œé©åˆ SaaS æ¨¡å¼ã€‚

### 4. Laravelã€FastAPI å’Œ Vue 3 å¦‚ä½•å”åŒå·¥ä½œï¼ŸFastAPI çš„ä½œç”¨æ˜¯ä»€éº¼ï¼Ÿ

**ç­”**ï¼š
- **Vue 3 â†” FastAPI**ï¼šå‰ç«¯é€é REST API èˆ‡ FastAPI é€šè¨Šï¼Œç²å–å»£å‘Šæ•¸æ“šå’Œæ¨è–¦çµæœã€‚
- **FastAPI â†” Laravel**ï¼šFastAPI ä½œç‚ºçµ±ä¸€é–˜é“ï¼Œå°‡è«‹æ±‚è½‰ç™¼çµ¦ Laravelï¼ˆé€é HTTP æˆ–å…§éƒ¨ç¶²è·¯ï¼‰ï¼Œä¸¦æ³¨å…¥ç§Ÿæˆ¶è³‡è¨Šï¼ˆ`X-Tenant-Id`ï¼‰ã€‚
- **Kafka**ï¼šè™•ç†å³æ™‚äº‹ä»¶ï¼ˆå¦‚é»æ“Šã€å±•ç¤ºï¼‰ï¼Œä¾› FastAPI çš„æ¨è–¦å¼•æ“ä½¿ç”¨ã€‚

**FastAPI çš„ä½œç”¨**ï¼š
- çµ±ä¸€ API å…¥å£ï¼Œç°¡åŒ–å‰ç«¯èˆ‡å¾Œç«¯é€šè¨Šã€‚
- è™•ç† JWT é©—è­‰å’Œé€Ÿç‡é™åˆ¶ï¼Œä¿è­·å¾Œç«¯ã€‚
- æ”¯æ´äº‹ä»¶æµè™•ç†ï¼Œèˆ‡ Kafka æ•´åˆï¼Œæä¾›å³æ™‚æ¨è–¦ã€‚

### 5. å°ˆæ¡ˆä½¿ç”¨äº†å“ªäº›è³‡æ–™å„²å­˜ï¼Ÿå®ƒå€‘çš„ç”¨é€”æ˜¯ä»€éº¼ï¼Ÿ

**ç­”**ï¼š
- **MySQL**ï¼šå„²å­˜çµæ§‹åŒ–æ•¸æ“šï¼ˆç”¨æˆ¶ã€å»£å‘Šã€ç§Ÿæˆ¶é…ç½®ï¼‰ï¼Œæ”¯æ´é—œè¯æŸ¥è©¢ã€‚
- **Redis**ï¼šç”¨æ–¼å¿«å–å’Œä½‡åˆ—ç®¡ç†ï¼Œæå‡æ€§èƒ½ã€‚
- **Kafka**ï¼šè™•ç†å³æ™‚äº‹ä»¶æµï¼ˆé»æ“Šã€å±•ç¤ºï¼‰ï¼Œæ”¯æ´æ¨è–¦å’Œåˆ†æã€‚

**é¸æ“‡åŸå› **ï¼š
- MySQL ç©©å®šä¸”æ”¯æ´é—œè¯æŸ¥è©¢ï¼Œé©åˆæ¥­å‹™é‚è¼¯ã€‚
- Redis æä¾›é«˜æ•ˆå¿«å–å’Œä½‡åˆ—ã€‚
- Kafka ç¢ºä¿äº‹ä»¶æµçš„é«˜ååé‡å’Œå¯é æ€§ã€‚

### 6. å»£å‘Šç®¡ç†æµç¨‹å¦‚ä½•å¯¦ç¾ï¼Ÿå¦‚ä½•æ§åˆ¶æ¬Šé™ï¼Ÿ

**ç­”**ï¼šå»£å‘Šç®¡ç†æ”¯æ´å‰µå»ºã€ç·¨è¼¯ã€æŠ•æ”¾å’Œå ±è¡¨ç”Ÿæˆï¼š
- **æµç¨‹**ï¼šå»£å‘Šé€é `AdController` å‰µå»ºï¼Œç‹€æ…‹åŒ…æ‹¬ã€Œè‰ç¨¿ã€ã€ã€Œæ´»èºã€å’Œã€ŒçµæŸã€ã€‚
- **æ¬Šé™æ§åˆ¶ï¼ˆRBACï¼‰**ï¼šä½¿ç”¨ `spatie/laravel-permission`ï¼Œå®šç¾©è§’è‰²ï¼ˆ`advertiser`ã€`viewer`ï¼‰å’Œæ¬Šé™ï¼ˆ`create ads`ã€`view reports`ï¼‰ã€‚`AdPolicy` æª¢æŸ¥æ“ä½œæ¬Šé™ã€‚
- **æ—¥èªŒè¨˜éŒ„**ï¼šä½¿ç”¨ `Spatie\Activitylog` è¨˜éŒ„å»£å‘Šæ“ä½œï¼Œç¢ºä¿å¯è¿½æº¯ã€‚

### 7. å¦‚ä½•å¯¦ç¾å€‹äººåŒ–æ¨è–¦ï¼Ÿ

**ç­”**ï¼šFastAPI é€é Kafka æ¶ˆè²»äº‹ä»¶ï¼ˆé»æ“Šã€å±•ç¤ºï¼‰ï¼Œçµåˆ Redis å¿«å–å’Œ MySQL æ•¸æ“šï¼Œç”Ÿæˆæ¨è–¦ï¼š
- **äº‹ä»¶è™•ç†**ï¼šKafka ä¸»é¡Œï¼ˆ`click`ã€`impression`ï¼‰è¨˜éŒ„ç”¨æˆ¶è¡Œç‚ºã€‚
- **æ¨è–¦é‚è¼¯**ï¼šFastAPI çš„ `/recommend` ç«¯é»è™•ç†ç°¡å–®è¦å‰‡æˆ–æ©Ÿå™¨å­¸ç¿’æ¨¡å‹ï¼ˆéœ€è‡ªè¡Œå¯¦ç¾ï¼‰ã€‚
- **å¿«å–**ï¼šRedis å„²å­˜ç†±é–€å»£å‘Šï¼Œé™ä½è³‡æ–™åº«è² è¼‰ã€‚

### 8. å ±è¡¨åŠŸèƒ½å¦‚ä½•å¯¦ç¾ï¼Ÿ

**ç­”**ï¼šå ±è¡¨é€é `ReportController` æä¾›ï¼š
- **ç«¯é»**ï¼š`/api/reports/conversions`ï¼ˆè½‰æ›ç‡ï¼‰ã€`/api/reports/events`ï¼ˆäº‹ä»¶çµ±è¨ˆï¼‰ã€‚
- **å¯¦ç¾**ï¼šå¾ `events` è¡¨æŒ‰ `tenant_id` èšåˆæ•¸æ“šï¼Œç”Ÿæˆå³æ™‚å ±è¡¨ã€‚
- **ç›£æ§**ï¼šPrometheus è¨˜éŒ„å ±è¡¨æŸ¥è©¢æ¬¡æ•¸ï¼ŒGrafana å±•ç¤ºè¶¨å‹¢ã€‚

### 9. å¦‚ä½•ç¢ºä¿ API å®‰å…¨æ€§å’Œé€Ÿç‡é™åˆ¶ï¼Ÿ

**ç­”**ï¼š
- **èº«ä»½é©—è­‰**ï¼šLaravel ä½¿ç”¨ `Sanctum` ç”Ÿæˆå’Œé©—è­‰ API Tokenï¼ŒFastAPI ä½¿ç”¨ JWTã€‚
- **æ¬Šé™æ§åˆ¶**ï¼š`Spatie\Permission` å¯¦ç¾ RBACï¼Œé€é `AdPolicy` æª¢æŸ¥æ“ä½œæ¬Šé™ã€‚
- **é€Ÿç‡é™åˆ¶**ï¼š
  - Laravel ä½¿ç”¨ `throttle:api` ä¸­é–“ä»¶ã€‚
  - FastAPI ä½¿ç”¨ `slowapi` é™åˆ¶å…¨å±€æˆ–ç«¯é»è«‹æ±‚ã€‚
- **HTTPS**ï¼šTraefik æ•´åˆ Let's Encrypt å•Ÿç”¨ TLSã€‚
- **éŒ¯èª¤è¿½è¹¤**ï¼šSentry ç›£æ§ API éŒ¯èª¤ä¸¦ç™¼é€å‘Šè­¦ã€‚

### 10. CI/CD æµç¨‹å¦‚ä½•é‹ä½œï¼Ÿæœ‰å“ªäº›å®‰å…¨æªæ–½ï¼Ÿ

**ç­”**ï¼š
- **CIï¼ˆæŒçºŒé›†æˆï¼‰**ï¼š
  - æ¨é€ä»£ç¢¼åˆ° `main` æˆ– `develop` åˆ†æ”¯ï¼Œè§¸ç™¼ GitHub Actionsã€‚
  - å®‰è£ä¾è³´ï¼ˆComposerã€Pipã€NPMï¼‰ï¼Œé‹è¡Œæ¸¬è©¦ï¼ˆPHPUnitã€Pytestã€Jestï¼‰ã€‚
  - æ§‹å»º Docker æ˜ åƒï¼Œä½¿ç”¨ Trivy æƒææ¼æ´ã€‚
- **CDï¼ˆæŒçºŒéƒ¨ç½²ï¼‰**ï¼š
  - CI æˆåŠŸå¾Œï¼Œå°‡æ˜ åƒæ¨é€åˆ°å®¹å™¨è¨»å†Šè¡¨ï¼Œæ”¯æ´æœ¬åœ°æˆ–é›²ç«¯éƒ¨ç½²ã€‚
- **å®‰å…¨æªæ–½**ï¼š
  - **Trivy**ï¼šæƒæ Docker æ˜ åƒæ¼æ´ã€‚
  - **Dependabot**ï¼šè‡ªå‹•æª¢æ¸¬ä¾è³´æ¼æ´ä¸¦æäº¤æ›´æ–° PRã€‚
  - **Secrets ç®¡ç†**ï¼šä½¿ç”¨ GitHub Secrets å„²å­˜æ•æ„Ÿè³‡è¨Šã€‚

### 11. ç§Ÿæˆ¶åˆå§‹åŒ–å¦‚ä½•å¯¦ç¾ã€Œä¸€éµåŒ–ã€ï¼Ÿ

**ç­”**ï¼šé€éè‡ªå®šç¾© Artisan å‘½ä»¤ `tenants:create`ï¼š
- å‰µå»ºç§Ÿæˆ¶è¨˜éŒ„ï¼ˆMySQLï¼‰ã€‚
- åˆå§‹åŒ–ç§Ÿæˆ¶ä¸Šä¸‹æ–‡ï¼Œè¨­ç½®è§’è‰²å’Œæ¬Šé™ã€‚
- é€šçŸ¥ FastAPIï¼ˆé€é Webhookï¼‰æ›´æ–°é–˜é“é…ç½®ã€‚
- ä½¿ç”¨å–®ä¸€å‘½ä»¤å®Œæˆè¨­ç½®ï¼Œç°¡åŒ–æ“ä½œã€‚

### 12. å°ˆæ¡ˆé–‹ç™¼ä¸­çš„ä¸»è¦æŒ‘æˆ°æ˜¯ä»€éº¼ï¼Ÿå¦‚ä½•è§£æ±ºï¼Ÿ

**ç­”**ï¼š
- **æŒ‘æˆ° 1ï¼šäº‹ä»¶æµèˆ‡æ¨è–¦æ€§èƒ½**
  - **å•é¡Œ**ï¼šKafka äº‹ä»¶æµçš„é«˜ååé‡å’Œå³æ™‚æ¨è–¦çš„æ€§èƒ½è¦æ±‚ã€‚
  - **è§£æ±ºæ–¹æ¡ˆ**ï¼šä½¿ç”¨ Kafka åˆ†å€æå‡ååé‡ï¼ŒRedis å¿«å–é™ä½å»¶é²ã€‚
- **æŒ‘æˆ° 2ï¼šå¤šç§Ÿæˆ¶æ•¸æ“šéš”é›¢**
  - **å•é¡Œ**ï¼šç¢ºä¿ç§Ÿæˆ¶æ•¸æ“šéš”é›¢ä¸”ä¸å½±éŸ¿æ€§èƒ½ã€‚
  - **è§£æ±ºæ–¹æ¡ˆ**ï¼š`SetTenant` ä¸­é–“ä»¶å’Œ `TenantScope` ç¢ºä¿æ•¸æ“šéš”é›¢ï¼ŒTraefik å‹•æ…‹è·¯ç”±å„ªåŒ–è«‹æ±‚åˆ†ç™¼ã€‚
- **æŒ‘æˆ° 3ï¼šç›£æ§èˆ‡éŒ¯èª¤è¿½è¹¤**
  - **å•é¡Œ**ï¼šå¤šæœå‹™ç’°å¢ƒä¸‹çš„éŒ¯èª¤å®šä½ã€‚
  - **è§£æ±ºæ–¹æ¡ˆ**ï¼šPrometheus å’Œ Grafana æä¾›å³æ™‚ç›£æ§ï¼ŒSentry è¿½è¹¤éŒ¯èª¤ã€‚

### 13. æœªä¾†å¦‚ä½•æ“´å±• AdStackXï¼Ÿ

**ç­”**ï¼š
- **AI æ¨è–¦**ï¼šæ•´åˆå”åŒéæ¿¾æˆ–æ·±åº¦å­¸ç¿’æ¨¡å‹ï¼Œæå‡æ¨è–¦ç²¾æº–åº¦ã€‚
- **æ—¥èªŒç³»çµ±**ï¼šæ–°å¢ ELK Stack é›†ä¸­åŒ–æ—¥èªŒç®¡ç†ã€‚
- **é›²ç«¯éƒ¨ç½²**ï¼šæ”¯æ´ Kubernetes æˆ– AWS ECSï¼Œæå‡é«˜å¯ç”¨æ€§ã€‚
- **åˆ†ä½ˆå¼è¿½è¹¤**ï¼šä½¿ç”¨ Jaeger/OpenTelemetry è¿½è¹¤è«‹æ±‚è·¯å¾‘ã€‚
- **æ•¸æ“šåˆ†æ**ï¼šæ•´åˆæ•¸æ“šæ¹–ï¼ˆå¦‚ AWS Redshiftï¼‰é€²è¡Œè·¨ç§Ÿæˆ¶åˆ†æã€‚

## ç³»çµ±æ¶æ§‹

ä»¥ä¸‹æ˜¯ AdStackX çš„ç³»çµ±æ¶æ§‹åœ–ï¼Œä½¿ç”¨ä¸­æ–‡æ¨™ç±¤ä¸¦å„ªåŒ– Mermaid æ ¼å¼ä»¥ç¢ºä¿æ¸²æŸ“æ­£ç¢ºã€‚

```mermaid
flowchart TD
  subgraph Tenant A & B
    TenantA([Tenant A])
    TenantB([Tenant B])
  end

  TenantA --> Laravel
  TenantB --> Laravel

  subgraph Laravel Backend
    Laravel[Laravel App]
    Auth[ä½¿ç”¨è€…ç™»å…¥/è¨»å†Š]
    RBAC[RBAC æ¬Šé™æ§ç®¡ (Spatie)]
    Ads[å»£å‘Šè¨­å®š CRUD + æ’ç¨‹]
    Reports[å ±è¡¨æ¨¡çµ„ (CTR/CVR API)]
    APIs[RESTful API + Swagger Docs]
    Laravel --> Auth
    Laravel --> RBAC
    Laravel --> Ads
    Laravel --> Reports
    Laravel --> APIs
  end

  Laravel -->|user_id, ad_id, event_type| FastAPI

  subgraph FastAPI Recommender
    FastAPI[FastAPI æ¨è–¦æœå‹™]
    CF[å”åŒéæ¿¾æ¨è–¦å¼•æ“]
    Kafka[Kafka å‚³é€äº‹ä»¶æµ]
    Redis[Redis å¯«å…¥å‚™æ´ä½‡åˆ—]
    FastAPI --> CF
    FastAPI --> Kafka
    FastAPI --> Redis
  end

  Laravel <-->|æ¨è–¦çµæœ API| FastAPI

  Reports --> Dashboard[ğŸ“Š Vue.js å„€è¡¨æ¿ (Chart.js & ECharts)]
  Dashboard -->|Token èªè­‰ + X-Tenant-ID| Laravel

  subgraph Database & Infra
    MySQL[(MySQL è³‡æ–™åº«)]
    Redis[(Redis å¿«å–)]
    Kafka[(Kafka äº‹ä»¶æµ)]
    MySQL <-- Laravel
    MySQL <-- FastAPI
    Redis <-- FastAPI
    Kafka <-- FastAPI
  end

  subgraph DevOps
    Traefik[Traefik åå‘ä»£ç†]
    Docker[Docker Compose]
    CI[GitHub Actions (CI/CD)]
    Traefik --> Laravel
    Traefik --> FastAPI
    Traefik --> Dashboard
    Docker --> Laravel
    Docker --> FastAPI
    Docker --> Dashboard
    CI --> Docker
  end

  classDef highlight fill:#fdf6e3,stroke:#268bd2,stroke-width:2px;
  class Laravel,FastAPI,Dashboard highlight;

```

**èªªæ˜**ï¼š
- **Traefik**ï¼šæ ¹æ“šåŸŸåè·¯ç”±è«‹æ±‚è‡³å‰ç«¯ã€Laravel æˆ– FastAPIã€‚
- **Laravel**ï¼šè™•ç†å»£å‘Šç®¡ç†å’Œå ±è¡¨é‚è¼¯ã€‚
- **FastAPI**ï¼šé‹è¡Œæ¨è–¦å¼•æ“ï¼Œæ¶ˆè²» Kafka äº‹ä»¶ã€‚
- **ç›£æ§**ï¼šPrometheus æ”¶é›†æŒ‡æ¨™ï¼ŒGrafana å±•ç¤ºå„€è¡¨æ¿ã€‚

## ç’°å¢ƒè¦æ±‚

- **Docker** å’Œ **Docker Compose**ï¼ˆæœ¬åœ°é–‹ç™¼ï¼‰
- **PHP**ï¼ˆv8.1+ï¼ŒLaravelï¼‰
- **Python**ï¼ˆv3.9+ï¼ŒFastAPIï¼‰
- **Node.js**ï¼ˆv18+ï¼ŒVue 3ï¼‰
- **æœå‹™**ï¼šMySQLï¼ˆv8.0ï¼‰ã€Redisï¼ˆv6.2ï¼‰ã€Kafkaï¼ˆv3.5.1ï¼‰ã€Zookeeperï¼ˆv3.8.3ï¼‰ã€Prometheusï¼ˆv2.47.0ï¼‰ã€Grafanaï¼ˆv10.2.2ï¼‰

## åˆå§‹åŒ– Laravel å°ˆæ¡ˆ

æœ¬å€‰åº«åƒ…åŒ…å«æ ¸å¿ƒç¨‹å¼ç¢¼ï¼Œéœ€åˆå§‹åŒ– Laravel å°ˆæ¡ˆä¸¦æ•´åˆï¼š

1. **å®‰è£ Laravel**ï¼š
   ```bash
   composer create-project laravel/laravel laravel
   cd laravel
   ```

2. **è¤‡è£½æ ¸å¿ƒç¨‹å¼ç¢¼**ï¼š
   å°‡å€‰åº«çš„ `laravel/` ç›®éŒ„ï¼ˆå¦‚ `app/Http/Controllers/AdController.php`ï¼‰è¤‡è£½åˆ°æ–°å°ˆæ¡ˆçš„ `laravel/app/`ã€‚

3. **å‰µå»ºè·¯ç”±æª”æ¡ˆ**ï¼š
   åœ¨ `laravel/routes/` å‰µå»º `api.php`ï¼š
   ```php
   <?php
   use Illuminate\Support\Facades\Route;
   use App\Http\Controllers\AdController;

   Route::middleware(['auth:sanctum', 'tenant'])->group(function () {
       Route::get('/ads', [AdController::class, 'index']);
       Route::post('/ads', [AdController::class, 'store']);
   });
   ```

4. **å‰µå»º .env æ–‡ä»¶**ï¼š
   ```bash
   cp .env.example .env
   ```
   ç·¨è¼¯ `.env`ï¼Œæ·»åŠ ä»¥ä¸‹è®Šæ•¸ï¼š
   ```env
   APP_NAME=AdStackX
   APP_ENV=local
   APP_KEY=
   APP_DEBUG=true
   APP_URL=http://ad-api.localhost

   DB_CONNECTION=mysql
   DB_HOST=mysql
   DB_PORT=3306
   DB_DATABASE=ad_platform_db
   DB_USERNAME=user
   DB_PASSWORD=secret

   REDIS_HOST=redis
   KAFKA_BROKER=kafka1:9092
   TRAEFIK_API_KEY=your_traefik_key
   SANCTUM_STATEFUL_DOMAINS=localhost,ad-api.localhost,recommender.localhost,frontend.localhost
   SENTRY_DSN=your_sentry_dsn
   ```

## å®‰è£ä¾è³´

éœ€æ‰‹å‹•å‰µå»ºä¾è³´é…ç½®æ–‡ä»¶ä¸¦å®‰è£ï¼š

### 1. Laravelï¼ˆPHP ä¾è³´ï¼‰
ç·¨è¼¯ `laravel/composer.json`ï¼š
```json
{
    "require": {
        "php": "^8.1",
        "laravel/framework": "^10.0",
        "laravel/sanctum": "^3.2",
        "spatie/laravel-permission": "^5.10",
        "spatie/laravel-activitylog": "^4.7",
        "darkaonline/l5-swagger": "^8.5"
    },
    "require-dev": {
        "phpunit/phpunit": "^10.0"
    }
}
```
å®‰è£ï¼š
```bash
cd laravel
composer install
```

### 2. FastAPIï¼ˆPython ä¾è³´ï¼‰
å‰µå»º `fastapi/requirements.txt`ï¼š
```text
fastapi==0.95.0
uvicorn==0.20.0
pydantic==1.10.7
aiokafka==0.8.0
redis==4.5.4
mysql-connector-python==8.0.33
slowapi==0.1.8
sentry-sdk==1.40.0
python-jose[cryptography]==3.3.0
```
å®‰è£ï¼š
```bash
cd fastapi
pip install -r requirements.txt
```

### 3. Vue 3ï¼ˆNode.js ä¾è³´ï¼‰
å‰µå»º `frontend/package.json`ï¼š
```json
{
    "dependencies": {
        "vue": "^3.2.47",
        "axios": "^1.4.0"
    },
    "devDependencies": {
        "@vitejs/plugin-vue": "^4.0.0",
        "vite": "^4.1.4",
        "jest": "^29.5.0",
        "@testing-library/vue": "^7.0.0"
    },
    "scripts": {
        "dev": "vite",
        "build": "vite build",
        "test": "jest"
    }
}
```
å®‰è£ï¼š
```bash
cd frontend
npm install
```

## å®‰è£æ­¥é©Ÿ

1. **è¤‡è£½å°ˆæ¡ˆ**ï¼š
   ```bash
   git clone https://github.com/BpsEason/ad-platform.git
   cd ad-platform
   ```

2. **åˆå§‹åŒ– Laravel å°ˆæ¡ˆä¸¦è¤‡è£½æ ¸å¿ƒç¨‹å¼ç¢¼**ï¼š
   è¦‹ã€Œåˆå§‹åŒ– Laravel å°ˆæ¡ˆã€ã€‚

3. **å‰µå»º Docker Compose é…ç½®**ï¼š
   åœ¨æ ¹ç›®éŒ„å‰µå»º `docker-compose.yml`ï¼š
   ```yaml
   version: '3.8'
   services:
     traefik:
       image: traefik:v2.9
       ports:
         - "80:80"
         - "8080:8080"
       volumes:
         - ./traefik.yml:/etc/traefik/traefik.yml
         - /var/run/docker.sock:/var/run/docker.sock
       networks:
         - ad_network
     laravel:
       build: ./laravel
       environment:
         - APP_ENV=local
         - APP_KEY=${APP_KEY}
         - DB_HOST=mysql
         - DB_DATABASE=${DB_DATABASE}
         - DB_USERNAME=${DB_USERNAME}
         - DB_PASSWORD=${DB_PASSWORD}
         - REDIS_HOST=redis
       volumes:
         - ./laravel:/var/www/html
         - ./docker/entrypoint.sh:/entrypoint.sh
       depends_on:
         - mysql
         - redis
       networks:
         - ad_network
       labels:
         - "traefik.http.routers.laravel.rule=Host(`ad-api.localhost`)"
     fastapi:
       build: ./fastapi
       environment:
         - KAFKA_BROKER=${KAFKA_BROKER}
         - REDIS_HOST=redis
         - DB_HOST=mysql
         - DB_NAME=${DB_DATABASE}
         - DB_USER=${DB_USERNAME}
         - DB_PASSWORD=${DB_PASSWORD}
       depends_on:
         - kafka1
         - redis
         - mysql
       networks:
         - ad_network
       labels:
         - "traefik.http.routers.fastapi.rule=Host(`recommender.localhost`)"
     frontend:
       build: ./frontend
       networks:
         - ad_network
       labels:
         - "traefik.http.routers.frontend.rule=Host(`frontend.localhost`)"
     mysql:
       image: mysql:8.0
       environment:
         - MYSQL_ROOT_PASSWORD=${DB_ROOT_PASSWORD}
         - MYSQL_DATABASE=${DB_DATABASE}
         - MYSQL_USER=${DB_USERNAME}
         - MYSQL_PASSWORD=${DB_PASSWORD}
       volumes:
         - mysql_data:/var/lib/mysql
       networks:
         - ad_network
     redis:
       image: redis:6.2
       networks:
         - ad_network
     zookeeper1:
       image: confluentinc/cp-zookeeper:7.3.0
       environment:
         ZOOKEEPER_CLIENT_PORT: 2181
         ZOOKEEPER_TICK_TIME: 2000
       networks:
         - ad_network
     kafka1:
       image: confluentinc/cp-kafka:7.3.0
       depends_on:
         - zookeeper1
       environment:
         KAFKA_BROKER_ID: 1
         KAFKA_ZOOKEEPER_CONNECT: zookeeper1:2181
         KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://kafka1:9092,EXTERNAL://localhost:9094
         KAFKA_LISTENERS: PLAINTEXT://:9092,EXTERNAL://:9094
         KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1
       ports:
         - "9094:9094"
       networks:
         - ad_network
     prometheus:
       image: prom/prometheus:v2.47.0
       volumes:
         - ./prometheus.yml:/etc/prometheus/prometheus.yml
       ports:
         - "9090:9090"
       networks:
         - ad_network
     grafana:
       image: grafana/grafana:10.2.2
       ports:
         - "3000:3000"
       environment:
         - GF_SECURITY_ADMIN_PASSWORD=admin
       networks:
         - ad_network
   networks:
     ad_network:
       driver: bridge
   volumes:
     mysql_data:
   ```

4. **å‰µå»º Traefik é…ç½®**ï¼š
   åœ¨æ ¹ç›®éŒ„å‰µå»º `traefik.yml`ï¼š
   ```yaml
   http:
     routers:
       api:
         rule: "Host(`traefik.localhost`)"
         service: api@internal
         middlewares:
           - auth
     middlewares:
       auth:
         basicAuth:
           users:
             - "admin:$apr1$your_hashed_password"
   ```

5. **å‰µå»º Laravel å…¥å£è…³æœ¬**ï¼š
   åœ¨ `docker/` ç›®éŒ„å‰µå»º `entrypoint.sh`ï¼š
   ```bash
   #!/bin/bash
   set -e
   if [ "${APP_KEY}" = "your_generated_key" ]; then
     echo "éŒ¯èª¤ï¼šAPP_KEY æœªè¨­ç½®ï¼Œè«‹é‹è¡Œ 'php artisan key:generate'ã€‚" >&2
     exit 1
   fi
   php artisan optimize
   php artisan serve --host=0.0.0.0 --port=80
   ```

6. **ç”Ÿæˆ Laravel æ‡‰ç”¨ç¨‹å¼é‡‘é‘°**ï¼š
   ```bash
   docker-compose run --rm laravel php artisan key:generate --show
   ```
   å°‡ç”Ÿæˆçš„ `APP_KEY` æ›´æ–°åˆ° `.env`ã€‚

7. **é‹è¡Œè³‡æ–™åº«é·ç§»**ï¼š
   ```bash
   docker-compose exec laravel php artisan migrate --force
   ```

8. **æ›´æ–° RouteServiceProvider**ï¼š
   åœ¨ `laravel/app/Providers/RouteServiceProvider.php` çš„ `boot` æ–¹æ³•æ·»åŠ ï¼š
   ```php
   public function boot()
   {
       $this->configureRateLimiting();
       $this->routes(function () {
           Route::middleware('api')
               ->prefix('api')
               ->group(base_path('routes/api.php'));
           Route::middleware(['api', \App\Http\Middleware\SetTenant::class])
               ->prefix('api')
               ->group(base_path('routes/api.php'));
       });
   }
   ```

9. **æ·»åŠ ç’°å¢ƒè®Šæ•¸é©—è­‰**ï¼š
   åœ¨ `laravel/public/index.php` æ·»åŠ ï¼š
   ```php
   require __DIR__.'/../bootstrap/validate_env.php';
   ```
   å‰µå»º `laravel/bootstrap/validate_env.php`ï¼š
   ```php
   <?php
   if (!env('APP_KEY')) {
       throw new RuntimeException('Application key not set in .env file.');
   }
   ```

## ä½¿ç”¨æ–¹æ³•

- **å‰ç«¯è¨ªå•**ï¼š`http://frontend.localhost`ï¼ˆVue 3ï¼‰
- **API é–˜é“**ï¼š`http://recommender.localhost/docs`ï¼ˆFastAPIï¼‰
- **Laravel å¾Œç«¯**ï¼š`http://ad-api.localhost/api`ï¼ˆé€é Traefik è¨ªå•ï¼‰
- **Prometheus UI**ï¼š`http://localhost:9090`
- **Grafana UI**ï¼š`http://localhost:3000`ï¼ˆç”¨æˆ¶ï¼šadminï¼Œå¯†ç¢¼ï¼šadminï¼‰

**é‹è¡Œæ¸¬è©¦**ï¼š
- **Laravel**ï¼š`docker-compose exec laravel vendor/bin/phpunit`
- **FastAPI**ï¼š`docker-compose exec fastapi pytest`
- **Vue 3**ï¼š`docker-compose exec frontend npm test`

## éƒ¨ç½²

1. **æ§‹å»ºä¸¦æ¨é€ Docker æ˜ åƒ**ï¼š
   ```bash
   docker build -t your_registry/adstackx-laravel:latest ./laravel
   docker build -t your_registry/adstackx-fastapi:latest ./fastapi
   docker build -t your_registry/adstackx-frontend:latest ./frontend
   docker push your_registry/adstackx-laravel:latest
   docker push your_registry/adstackx-fastapi:latest
   docker push your_registry/adstackx-frontend:latest
   ```

2. **æ‡‰ç”¨ Docker Compose é…ç½®**ï¼š
   ```bash
   docker-compose up --build -d
   ```

## é—œéµç¨‹å¼ç¢¼

ä»¥ä¸‹å±•ç¤º `laravel/app/Http/Controllers/AdController.php` çš„æ ¸å¿ƒæ–¹æ³•ï¼Œé«”ç¾å»£å‘Šç®¡ç†å’Œæ¬Šé™æ§åˆ¶åŠŸèƒ½ã€‚

### 1. `store()` æ–¹æ³•
è™•ç†å»£å‘Šå‰µå»ºï¼Œæª¢æŸ¥æ¬Šé™ä¸¦è¨˜éŒ„æ—¥èªŒã€‚

```php
/**
 * å‰µå»ºæ–°å»£å‘Šã€‚
 */
public function store(Request $request)
{
    // æª¢æŸ¥ç”¨æˆ¶æ˜¯å¦æœ‰å‰µå»ºæ¬Šé™
    $this->authorize('create', \App\Models\Ad::class);

    try {
        // é©—è­‰è¼¸å…¥æ•¸æ“š
        $data = $request->validate([
            'name' => 'required|string|max:255',
            'content' => 'required|string',
            'start_time' => 'required|date',
            'end_time' => 'required|date|after:start_time',
        ]) + ['tenant_id' => config('current_tenant_id')];

        // å‰µå»ºå»£å‘Š
        $ad = \App\Models\Ad::create($data);

        // è¨˜éŒ„å‰µå»ºæ—¥èªŒ
        activity()
            ->performedOn($ad)
            ->causedBy(auth()->user())
            ->event('created')
            ->log('å»£å‘Š ' . $ad->name . ' å·²å‰µå»ºã€‚');

        // è§¸ç™¼ Kafka äº‹ä»¶
        event(new \App\Events\AdCreated($ad));

        // è¨˜éŒ„ Prometheus æŒ‡æ¨™
        \Prometheus\Counter::get('ads_created_total')->inc(['tenant_id' => tenancy()->tenant->id]);

        return response()->json(['message' => 'å»£å‘Šå‰µå»ºæˆåŠŸ', 'ad' => $ad], 201);
    } catch (\Exception $e) {
        return response()->json(['error' => 'å‰µå»ºå»£å‘Šå¤±æ•—: ' . $e->getMessage()], 400);
    }
}
```

**åƒ¹å€¼**ï¼š
- **æ¬Šé™æ§åˆ¶**ï¼šRBAC ç¢ºä¿åªæœ‰æˆæ¬Šç”¨æˆ¶å¯å‰µå»ºå»£å‘Šã€‚
- **äº‹ä»¶é©…å‹•**ï¼šKafka äº‹ä»¶é€šçŸ¥æ¨è–¦å¼•æ“ã€‚
- **å¯è¿½æº¯æ€§**ï¼šæ—¥èªŒè¨˜éŒ„ä¾¿æ–¼å¯©è¨ˆã€‚
- **ç›£æ§**ï¼šPrometheus è¿½è¹¤å‰µå»ºæ¬¡æ•¸ã€‚

### 2. `index()` æ–¹æ³•
ç²å–ç§Ÿæˆ¶çš„å»£å‘Šåˆ—è¡¨ã€‚

```php
/**
 * ç²å–å»£å‘Šåˆ—è¡¨ã€‚
 */
public function index()
{
    $ads = \App\Models\Ad::where('tenant_id', config('current_tenant_id'))->get();
    return response()->json($ads);
}
```

**åƒ¹å€¼**ï¼š
- **æ•¸æ“šéš”é›¢**ï¼šé€é `TenantScope` è‡ªå‹•éæ¿¾ç§Ÿæˆ¶æ•¸æ“šã€‚
- **ç°¡å–®é«˜æ•ˆ**ï¼šç›´æ¥è¿”å› JSON éŸ¿æ‡‰ï¼Œé©åˆå‰ç«¯æ¸²æŸ“ã€‚

## è²¢ç»

æ­¡è¿æäº¤ Pull Request æˆ– Issueï¼æ­¥é©Ÿï¼š
1. Fork å€‰åº«ã€‚
2. å‰µå»ºç‰¹æ€§åˆ†æ”¯ï¼ˆ`git checkout -b feature/YourFeature`ï¼‰ã€‚
3. æäº¤æ›´æ”¹ï¼ˆ`git commit -m 'Add YourFeature'`ï¼‰ã€‚
4. æ¨é€åˆ†æ”¯ï¼ˆ`git push origin feature/YourFeature`ï¼‰ã€‚
5. å‰µå»º Pull Requestã€‚

## æˆæ¬Š

æ¡ç”¨ MIT æˆæ¬Šï¼Œè©³è¦‹ [LICENSE](LICENSE) æ–‡ä»¶ã€‚
